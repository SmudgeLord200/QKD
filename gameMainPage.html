<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <title>Game</title>
    <style>
        Canvas {
            background-color: #f1f1f1;
            display: block;
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            margin-top: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body onload="startGame()">

    <script>
        var alice, bob, eve, line, photon, pol_H_A, pol_H_B, pol_V_A, pol_V_B, pol_P45_A, pol_P45_B, pol_N45_A, pol_N45_B, pol_H_E1, pol_H_E2, pol_V_E1, pol_V_E2, pol_P45_E1, pol_P45_E2, pol_N45_E1, pol_45_E2;
        var eve_display = false; //whether to summon Eve or not
        var eve_state = 0; //0: no eavesdrop, 1: has eavesdrop
        var alice_45 = false, bob_45 = false; //false: Rectilinear, true: Diagonal
        var Alice = [], Bob = []; //Initialize two arrays for storing bit sequences
        var h = 0, v = 0, p45 = 0, n45 = 0; //Bit orientation
        var x = 0, y = 0 , z = 0;

        function startGame() {
            //Draw the required elements into the canvas
            alice = new component(80, 100, "Alice.jpg", 10, 20, "image");
            bob = new component(80, 100, "Bob.jpg", 1140, 20, "image");
            eve = new component(80, 100, "Eve.jpg", 550, 20, "image");
            line = new component(1050, 1, "black", 90, 70);
            photon = new component(30, 30, "red", 90, 60);

            //Polarization Bases of Alice and Bob
            pol_H_A = new component(90, 100, "Pol-H.png", 100, 10, "image");
            pol_H_B = new component(90, 100, "Pol-H.png", 1030, 10, "image");
            pol_V_A = new component(90, 100, "Pol-V.png", 100, 10, "image");
            pol_V_B = new component(90, 100, "Pol-V.png", 1030, 10, "image");
            pol_P45_A = new component(90, 100, "Pol-P45.png", 100, 10, "image");
            pol_P45_B = new component(90, 100, "Pol-P45.png", 1030, 10, "image");
            pol_N45_A = new component(90, 100, "Pol-N45.png", 100, 10, "image");
            pol_N45_B = new component(90, 100, "Pol-N45.png", 1030, 10, "image");

            //Polarization Bases of Eve
            pol_H_E1 = new component(90, 100, "Pol-H.png", 450, 10, "image");
            pol_H_E2 = new component(90, 100, "Pol-H.png", 650, 10, "image");
            pol_V_E1 = new component(90, 100, "Pol-V.png", 450, 10, "image");
            pol_V_E2 = new component(90, 100, "Pol-V.png", 650, 10, "image");
            pol_P45_E1 = new component(90, 100, "Pol-P45.png", 150, 10, "image");
            pol_P45_E2 = new component(90, 100, "Pol-P45.png", 150, 10, "image");
            pol_N45_E1 = new component(90, 100, "Pol-N45.png", 150, 10, "image");
            pol_N45_E2 = new component(90, 100, "Pol-N45.png", 150, 10, "image");

            //Start the game
            myGameArea.start();
        }

        //This is where the game starts, we draw the canvas into the page
        var myGameArea = {
            canvas: document.createElement("canvas"),
            start: function () {
                this.canvas.width = 1235;
                this.canvas.height = 110;
                this.context = this.canvas.getContext("2d");
                document.body.insertBefore(this.canvas, document.body.childNodes[0]);
                this.interval = setInterval(updateGameArea, 1);
            },
            //this function is to clear the images that we draw on the canvas
            clear: function () {
                this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
            }
        }

        //This is the method of how the images are drawn
        function component(width, height, color, x, y, type) {
            this.type = type;
            if (type == "image") {
                this.image = new Image();
                this.image.src = color;
            }
            this.width = width;
            this.height = height;
            this.x = x;
            this.y = y;
            this.update = function () {
                ctx = myGameArea.context;
                if (type == "image") {
                    ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
                } else {
                    ctx.fillStyle = color;
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                }
            }
        }


        //This is the control for animation in the canvas and the related functions
        function updateGameArea() {

            //first clear the canvas
            myGameArea.clear();

            //then draw the image into it
            alice.update();
            bob.update();
            line.update();

            //Toggle between the display of Eve
            document.getElementById("eavesdrop").onclick = function () {
                if (!eve_display) {
                    document.getElementById("eavesdrop").innerHTML = "Stop Eavdesdropping"; //change the button text
                    eve_display = true; //display Eve in the canvas
                    eve_state = 1; //Has eavesdropping
                } else {
                    document.getElementById("eavesdrop").innerHTML = "Eavdesdrop"; //chnage the button text
                    eve_display = false; //remove Eve from the canvas
                    eve_state = 0; //No eavesdropping
                }
            }

            //Then, we draw Eve
            if (eve_display == true) {
                eve.update();
                pol_V_E1.update();
                pol_V_E2.update();
            }


            //Toggle between the radio buttons on the polarization base selection
            //aliceOptHV, aliceOpt45, randomP, fixedP, bobOptHV, bobOpt45
            //If random polarization base is checked, all other selection buttons are disabled
            document.getElementById("randomP").onclick = function () {
                document.getElementById("aliceOptHV").disabled = true;
                document.getElementById("aliceOpt45").disabled = true;
                document.getElementById("bobOptHV").disabled = true;
                document.getElementById("bobOpt45").disabled = true;
            }

            //If fixed polarization base is checked, all other selection buttons are released
            document.getElementById("fixedP").onclick = function () {
                document.getElementById("aliceOptHV").disabled = false;
                document.getElementById("aliceOpt45").disabled = false;
                document.getElementById("bobOptHV").disabled = false;
                document.getElementById("bobOpt45").disabled = false;
            }

            //pol_H_A.update();
            //pol_H_B.update();

            //Show the corresponding image according to the selected radio button
            if (document.getElementById("aliceOptHV").checked) {
                pol_V_A.update();
            } else {
                alice_45 = true; //Diagonal basis
                pol_P45_A.update();
            }

            if (document.getElementById("bobOptHV").checked) {
                pol_V_B.update();
            } else {
                bob_45 = true; //Diagonal basis
                pol_P45_B.update();
            }

            if (document.getElementById("1").checked) {
                h = 1;
                v = 0;
                p45 = 1;
                n45 = 0;
            } else {
                h = 0;
                v = 1;
                p45 = 0;
                n45 = 1;
            }

            document.getElementById("single").onclick = function () {

                //Fixed Basis
                if (document.getElementById("fixedP").checked) {

                    //Rectilinear Basis
                    if (alice_45 === false && bob_45 === false) {
                        //Radnomly switch between horizontal and vertical basis
                        x = Math.floor(Math.random()*2);
                        //0 is V, 1 is A 
                        if (x == 0) {
                            pol_V_A.update();
                            console.log("Vertical");
                            Alice.push(v);
                            console.log("Alice: ", Alice)
                        } else {
                            pol_H_A.update();
                            console.log("Horizontal");
                            Alice.push(h);
                            console.log("Alice: ", Alice)
                        }
                        //Assign corresponding bit value to both arrays
                        //Display the bit sequence to the tables                        
                    }
                    //Diagonal
                    else if (alice_45 === true && bob_45 === true) {
                        //Radnomly switch between P45 and N45 basis
                        //Assign corresponding bit value to both arrays
                        //Display the bit sequence to the tables        
                    }
                    //If the two bases are not equal
                    else {
                        //Radnomly switch between their own basis
                        //A switch statement to obtain their corresponding basis
                        //Maybe two random methods here
                        //Assign corresponding bit value to both arrays
                        //Display the bit sequence to the tables          
                    }
                }

                //Random Basis
                else {
                    //Randomly switch between Rectilinear and Diagonal Basis
                    //Maybe two random methods here
                    //Assign corresponding bit value to both arrays
                    //Display the bit sequence to the tables 
                }
            }

            //Draw the photon to the canvas
            photon.update();
            //photon.x += 1;
        }
    </script>

    <div class="container-fluid">

        <!--Polarization Base Settings-->
        <div class="row border g-0">
            <p class="text-center mb-0"><u>Polarization Base</u></p>

            <!--Alice Polarization Base Settings-->
            <div class="col-4 text-center border">
                <p class="mb-0"><u>Alice's Base</u></p>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="aliceOptHV" name="Alice" value="AHV" checked>
                    <label class="form-check-label" for="aliceOptHV">H/V</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="aliceOpt45" name="Alice" value="A45">
                    <label class="form-check-label" for="aliceOpt45">+45/-45</label>
                </div>
            </div>

            <!--Overall Polarization Base Settings-->
            <div class="col-4 text-center my-auto">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="randomP" name="overallPB" value="Radnom">
                    <label class="form-check-label" for="randomP">Radnom</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="fixedP" name="overallPB" value="Fixed" checked>
                    <label class="form-check-label" for="fixedP">Fixed</label>
                </div>
            </div>

            <!--Bob Polarization Base Settings-->
            <div class="col-4 text-center border">
                <p class="mb-0"><u>Bob's Base</u></p>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="bobOptHV" name="Bob" value="BHV" checked>
                    <label class="form-check-label" for="bobOptHV">H/V</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="bobOpt45" name="Bob" value="B45">
                    <label class="form-check-label" for="bobOpt45">+45/-45</label>
                </div>
            </div>
        </div>

        <div class="row border g-0 mt-2">
            <!--Polarization State Settings-->
            <div class="col-3 border text-center">
                <p class="mb-0"><u>Polarization State</u></p>
                <div class="form-check form-check-inline col-5" style="margin-left: 5px;">
                    <input class="form-check-input" type="radio" id="1" name="overallPS" value="1" checked>
                    <label class="form-check-label" for="1"><img src="Polarization-State-01.jpg"
                            alt="Polarization-State-01" class="img-fluid" style="height: 170px;"></label>
                </div>
                <div class="form-check form-check-inline col-5">
                    <input class="form-check-input" type="radio" id="2" name="overallPS" value="2">
                    <label class="form-check-label" for="2"><img src="Polarization-State-02.jpg"
                            alt="Polarization-State-02" class="img-fluid" style="height: 170px;"></label>
                </div>

                <!--Main Control Buttons-->
                <div class="border mt-3">
                    <p class="mb-1"><u>Main Controls</u></p>
                    <div class="d-grid gap-2 d-block mx-auto col-9 pb-3">
                        <button id="single" type="button" class="btn btn-primary btn-sm">Send Single
                            Photon</button>
                        <button id="continuous" type="button" class="btn btn-primary btn-sm">Send
                            Continuously</button>
                        <button id="fast" type="button" class="btn btn-primary btn-sm">Fast
                            Forward 15 Photons</button>
                        <button id="eavesdrop" type="button" class="btn btn-primary btn-sm">Eavesdrop</button>
                        <button id="clear" type="button" class="btn btn-primary btn-sm">Clear</button>
                    </div>
                </div>
            </div>

            <div class="col-9 border">
                <table class="table table-bordered table-sm">
                    <thead class="th-sm">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Alice</th>
                            <th scope="col">Bob</th>
                            <th scope="col">Eve</th>
                            <th scope="col">Same Base?</th>
                            <th scope="col">Resulting Bit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">1</th>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <th scope="row">2</th>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <th scope="row">3</th>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <th scope="row">4</th>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <th scope="row">5</th>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>

                <table class="table table-bordered table-sm">
                    <thead class="th-sm">
                        <tr>
                            <th scope="col">Alice (of the same base)</th>
                            <th scope="col">Bob (of the same base)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>

                <div class="d-grid d-block mx-auto col-5"><button type="button" class="btn btn-primary btn-sm"
                        onclick="document.location='/compareBits.html'">Compare 15 Photons</button></div>
            </div>
        </div>

        <div class="d-flex justify-content-end border-top pt-1 mt-2">
            <button type="button" class="btn btn-primary btn-md"
                onclick="document.location='/gameForeword.html'">Back</button>
        </div>
    </div>
</body>

</html>